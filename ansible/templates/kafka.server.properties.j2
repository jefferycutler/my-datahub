# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Ansible managed

############################# Server Basics #############################

# The id of the node. This must be set to a unique integer for each node.
# We derive this from the host's index in the 'kafka' inventory group.
node.id={{ groups['kafka'].index(inventory_hostname) }}

# The cluster ID, must be the same for all nodes.
# We will generate this in the Ansible playbook.
cluster.id={{ kafka_cluster_id }}

############################# KRaft Controller Settings #############################

# A comma-separated list of nodes that will act as controllers.
# Format: id1@host1:port1,id2@host2:port2,...
controller.quorum.voters={% for host in groups['kafka'] if hostvars[host].kafka_is_controller | default(false) -%}
{{ groups['kafka'].index(host) }}@{{ host }}:9093{% if not loop.last %},{% endif %}
{%- endfor %}

# The name of the listener used by the controller.
controller.listener.names=CONTROLLER

############################# Socket Server Settings #############################
# The address the socket server listens on.
listeners=SASL_PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093

# The address that is advertised to other brokers and clients.
# Use the inventory_hostname for this, which resolves to the correct IP or FQDN.
advertised.listeners=SASL_PLAINTEXT://{{ inventory_hostname }}:9092

# Security protocol for inter-broker communication.
security.inter.broker.protocol=SASL_PLAINTEXT

############################# SASL/SCRAM Settings #############################

# Enable SCRAM-SHA-512 for client and inter-broker authentication.
sasl.mechanism.inter.broker.protocol=SCRAM-SHA-512
sasl.enabled.mechanisms=SCRAM-SHA-512

# Define the authorizer and the super user (admin).
authorizer.class.name=kafka.security.authorizer.AclAuthorizer
super.users=User:{{ kafka_admin_user }}
allow.everyone.if.no.acl.found=false

# The number of threads that the server uses for receiving requests from the network and sending responses to the network
num.network.threads=3

# The number of threads that the server uses for processing requests, which may include disk I/O
num.io.threads=8

############################# Log Basics #############################

# A comma-separated list of directories under which to store log files
log.dirs=/var/kafka

# The default number of log partitions per topic.
num.partitions=1

############################# Internal Topic Settings  #############################
offsets.topic.replication.factor=3
transaction.state.log.replication.factor=3
transaction.state.log.min.isr=2

############################# Log Retention Policy #############################
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
